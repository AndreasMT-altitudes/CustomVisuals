{"visual":{"name":"demoCreation","displayName":"Overlayering Stacked Column chart","guid":"demoCreation522AEF1866B94124B4C4F588A968843A","visualClassName":"Visual","version":"1.0.0.0","description":"Demo","supportUrl":"Demo.dk","gitHubUrl":""},"author":{"name":"Andreas Methling","email":"andreas.methling@gmail.com"},"apiVersion":"3.8.0","style":"style/visual.less","stringResources":{},"capabilities":{"dataRoles":[{"displayName":"Category","description":"Category to show on the x_axis","name":"category","kind":"Grouping"},{"displayName":"Lower column value 1","name":"l_col1","kind":"GroupingOrMeasure"},{"displayName":"Lower column value 2","name":"l_col2","kind":"GroupingOrMeasure"},{"displayName":"Lower column value 3","name":"l_col3","kind":"GroupingOrMeasure"},{"displayName":"Lower column value 4","name":"l_col4","kind":"GroupingOrMeasure"},{"displayName":"Lower column value 5","name":"l_col5","kind":"GroupingOrMeasure"},{"displayName":"Upper column value 1","name":"u_col1","kind":"GroupingOrMeasure"},{"displayName":"Upper column value 2","name":"u_col2","kind":"GroupingOrMeasure"},{"displayName":"Upper column value 3","name":"u_col3","kind":"GroupingOrMeasure"},{"displayName":"Upper column value 4","name":"u_col4","kind":"GroupingOrMeasure"},{"displayName":"Upper column value 5","name":"u_col5","kind":"GroupingOrMeasure"},{"displayName":"Small Multiple","name":"small_multi","kind":"GroupingOrMeasure"}],"dataViewMappings":[{"conditions":[{"category":{"max":1},"l_col1":{"max":1},"l_col2":{"min":0,"max":1},"l_col3":{"min":0,"max":1},"l_col4":{"min":0,"max":1},"l_col5":{"min":0,"max":1},"u_col1":{"max":1},"u_col2":{"min":0,"max":1},"u_col3":{"min":0,"max":1},"u_col4":{"min":0,"max":1},"u_col5":{"min":0,"max":1},"small_multi":{"min":0,"max":1}}],"scriptResult":{"dataInput":{"table":{"rows":{"select":[{"for":{"in":"category"}},{"for":{"in":"l_col1"}},{"for":{"in":"l_col2"}},{"for":{"in":"l_col3"}},{"for":{"in":"l_col4"}},{"for":{"in":"l_col5"}},{"for":{"in":"u_col1"}},{"for":{"in":"u_col2"}},{"for":{"in":"u_col3"}},{"for":{"in":"u_col4"}},{"for":{"in":"u_col5"}},{"for":{"in":"small_multi"}}],"dataReductionAlgorithm":{"top":{}}}}},"script":{"scriptProviderDefault":"R","scriptOutputType":"html","source":{"objectName":"rcv_script","propertyName":"source"},"provider":{"objectName":"rcv_script","propertyName":"provider"},"scriptSourceDefault":"############### Utility functions ###############\nlibraryRequireInstall = function(packageName, ...)\n{\n  if(!require(packageName, character.only = TRUE)) \n    warning(paste(\"*** The package: '\", packageName, \"' was not installed ***\", sep=\"\"))\n}\n\nlibraryRequireInstall(\"xml2\")\nlibraryRequireInstall(\"htmlwidgets\")\n\ninternalSaveWidget <- function(widget, fname)\n{\n  tempFname = paste(fname, \".tmp\", sep=\"\")\n  htmlwidgets::saveWidget(widget, file = tempFname, selfcontained = FALSE)\n  FlattenHTML(tempFname, fname)\n}\n\nFlattenHTML <- function(fnameIn, fnameOut)\n{\n  # Read and parse HTML file\n  # Embed all js and css files into one unified file\n  \n  if(!file.exists(fnameIn))\n    return(FALSE)\n  \n  dir = dirname(fnameIn)\n  html = read_html(fnameIn, useInternal = TRUE)\n  top = xml_root(html)\n  \n  # extract all <script> tags with src value\n  srcNode=xml_find_all(top, '//script[@src]')\n  for (node in srcNode)\n  {\n    b = xml_attrs(node)\n    fname = file.path(dir, b['src'])\n    alternateSrc = FindSrcReplacement(fname)\n    if (!is.null(alternateSrc))\n    {\n      s = alternateSrc\n      names(s) = 'src'\n      newNode = xml_new_root(\"script\")\n      xml_set_attrs(newNode, s)\n      xml_replace(node, newNode)\n    }else{\n      str=ReadFileForEmbedding(fname);\n      if (!is.null(str))\n      {      \n        newNode = xml_new_root(\"script\",str)\n        xml_set_attrs( newNode, c( type = \"text/javascript\") )\n        xml_replace(node, newNode)\n      }\n    }\n  }\n  \n  # extract all <link> tags with src value\n  linkNode=xml_find_all(top, '//link[@href]')\n  for (node in linkNode)\n  {\n    b = xml_attrs(node)\n    fname = file.path(dir, b['href'])\n    str = ReadFileForEmbedding(fname, FALSE);\n    if (!is.null(str))\n    {\n      newNode = xml_new_root(\"style\", str)\n      xml_replace(node, newNode)\n    }\n  }\n  \n  write_xml(html, file = fnameOut)\n  return(TRUE)\n}\n\nReadFileForEmbedding <- function(fname, addCdata = TRUE)\n{\n  data = ReadFullFile(fname)\n  if (is.null(data))\n    return(NULL)\n\n  str = paste(data, collapse ='\\n')\n  if (addCdata) {\n    str = paste(cbind('// <![CDATA[', str,'// ]]>'), collapse ='\\n')\n  }\n  return(str)\n}\n\nReadFullFile <- function(fname)\n{\n  if(!file.exists(fname))\n    return(NULL)\n  \n  con = file(fname, open = \"r\")\n  data = readLines(con)\n  close(con)\n  return(data)\n}\n\nFindSrcReplacement <- function(str)\n{\n  # finds reference to 'plotly' js and replaces with a version from CDN\n  # This allows the HTML to be smaller, since this script is not fully embedded in it\n  str <- iconv(str, to=\"UTF-8\")\n  pattern = \"plotly-(\\\\w.+)/plotly-latest.min.js\"\n  match1=regexpr(pattern, str)\n  attr(match1, 'useBytes') <- FALSE\n  strMatch=regmatches(str, match1, invert = FALSE)\n  if (length(strMatch) == 0) return(NULL)\n  \n  pattern2 = \"-(\\\\d.+)/\"\n  match2 = regexpr(pattern2, strMatch[1])\n  attr(match2, 'useBytes') <- FALSE\n  strmatch = regmatches(strMatch[1], match2)\n  if (length(strmatch) == 0) return(NULL)\n  \n  # CDN url is https://cdn.plot.ly/plotly-<Version>.js\n  # This matches the specific version used in the plotly package used.\n  verstr = substr(strmatch, 2, nchar(strmatch)-1)\n  str = paste('https://cdn.plot.ly/plotly-', verstr,'.min.js', sep='')\n  return(str)\n}\n\nReadFullFileReplaceString <- function(fnameIn, fnameOut, sourceString,targetString) {\n  # Replaces texts in file\n  # This makes it possible to replace e.g. paddings in the generated html widget code\n  if(!file.exists(fnameIn))\n    return(NULL)\n  tx  <- readLines(fnameIn,encoding = \"UTF-8\")\n  tx2  <- gsub(pattern = sourceString, replace = targetString, x = tx)\n  writeLines(tx2, con = fnameOut)\n}\n#################################################\n\n\n############### Library Declarations ###############\nsuppressWarnings(suppressMessages(libraryRequireInstall(\"ggplot2\")));\nsuppressWarnings(suppressMessages(libraryRequireInstall(\"plotly\")))\nsuppressWarnings(suppressMessages(libraryRequireInstall(\"tidyverse\")))\nsuppressWarnings(suppressMessages(libraryRequireInstall(\"scales\")))\nsuppressWarnings(suppressMessages(libraryRequireInstall(\"tsibble\")))\nsuppressWarnings(suppressMessages(libraryRequireInstall(\"lubridate\")))\n####################################################\n\n################### Actual code ####################\n###################Dealing with errors##############\nif(!exists(\"category\")) {\n  errorText <- \"There needs to be a categorical column\n                </br> in the Category field\"\n  g = ggplot() + geom_text(aes(x = 0.5, y = 0.5, label = errorText), size = 5) +\n    theme(\n      axis.title.x = element_blank(),\n      axis.text.x = element_blank(),\n      axis.ticks.x = element_blank(),\n      axis.title.y = element_blank(),\n      axis.text.y = element_blank(),\n      axis.ticks.y = element_blank()\n    )\n  p = ggplotly(g) %>%\n    layout(plot_bgcolor='#FFFFFF',\n           yaxis = list(zerolinecolor = '#ffff',\n                        zerolinewidth = 2,\n                        gridcolor = 'ffff',\n                        showticklabels=FALSE),\n           xaxis = list(zerolinecolor = '#ffff',\n                        zerolinewidth = 2,\n                        gridcolor = 'ffff',\n                        showticklabels=FALSE))\n  internalSaveWidget(p, 'out.html')\n  ReadFullFileReplaceString('out.html', 'out.html', ',\"padding\":[0-9]*,', ',\"padding\":0,')\n  quit()                       \n}\n\n###########Settings defualt values for formating options############\nnum_cols <- 5\n\n##Setting Labels to True in the enviroment, if nothing is supplied\nfor (i in 1:num_cols) {\n  label_name <- paste0(\"LowerColumnValue\", i, \"Format_textLabel\")\n  if (!exists(label_name)) {\n    assign(label_name, FALSE, envir = .GlobalEnv)\n  }\n}\n\nfor (i in 1:num_cols) {\n  label_name <- paste0(\"UpperColumnValue\", i, \"Format_textLabel\")\n  if (!exists(label_name)) {\n    assign(label_name, FALSE, envir = .GlobalEnv)\n  }\n}\n\n##Setting label placement to default values if nothing else is supplied\nfor (i in 1:num_cols) {\n  label_name <- paste0(\"LowerColumnValue\", i, \"Format_labelPlace\")\n  if (!exists(label_name)) {\n    assign(label_name, \"top\", envir = .GlobalEnv)\n  }\n}\n\nfor (i in 1:num_cols) {\n  label_name <- paste0(\"UpperColumnValue\", i, \"Format_labelPlace\")\n  if (!exists(label_name)) {\n    assign(label_name, \"top\", envir = .GlobalEnv)\n  }\n}\n\n##########General Plotting settings####################\nif (!exists(\"GeneralPlot_colBack\")) {\n  GeneralPlot_colBack = \"#FFFFFF\"\n}\n\nif (!exists(\"GeneralPlot_colGrid\")) {\n  GeneralPlot_colGrid = \"#F1F2F3\"\n}\n\n##########Small Multi Settings##########################\nif (!exists(\"SmallMultiSettings_numCol\")) {\n  SmallMultiSettings_numCol = 2\n} else {\n  SmallMultiSettings_numCol = as.numeric(SmallMultiSettings_numCol)\n}\n\n\n##########Legend Settings###################\nif (!exists(\"LegendSettings_Orientation\")) {\n  LegendSettings_Orientation = \"h\"\n}\n\nif (!exists(\"LegendSettings_textSize\")) {\n  LegendSettings_textSize = \"8\"\n}\n\nif (!exists(\"LegendSettings_legendTitle\")) {\n  LegendSettings_legendTitle = \"\"\n}\nif (!exists(\"LegendSettings_legendTitleSize\")) {\n  LegendSettings_legendTitleSize = \"12\"\n}\n\n\n##########Bar Settings###################\nif (!exists(\"BarSettings_textSize\")) {\n  BarSettings_textSize = 12/4\n} else {\n  BarSettings_textSize = as.numeric(BarSettings_textSize)/4\n}\n\nif (!exists(\"BarSettings_colLabel\")) {\n  BarSettings_colLabel = \"black\"\n}\n\nif (!exists(\"BarSettings_LBarSize\")) {\n  BarSettings_LBarSize = 0.6\n} else {\n   as.numeric(BarSettings_LBarSize)\n}\n\nif (!exists(\"BarSettings_UBarSize\")) {\n  BarSettings_UBarSize = 0.35\n} else {\n   as.numeric(BarSettings_UBarSize)\n}\n\n\n##########Axes Settings###################\nif (!exists(\"mySettingsAxes_x_axis_title\")) {\n  mySettingsAxes_x_axis_title = \"\"\n}\n\nif (!exists(\"mySettingsAxes_y_axis_title\")) {\n  mySettingsAxes_y_axis_title = \"\"\n}\n\nif (!exists(\"mySettingsAxes_x_axis_titleTextSize\")) {\nmySettingsAxes_x_axis_titleTextSize = 10\n}\n\nif (!exists(\"mySettingsAxes_y_axis_titleTextSize\")) {\nmySettingsAxes_y_axis_titleTextSize = 10\n}\n\nif (!exists(\"mySettingsAxes_x_axis_textSize\")) {\n mySettingsAxes_x_axis_textSize = 8\n}\n\nif (!exists(\"mySettingsAxes_y_axis_textSize\")) {\n mySettingsAxes_y_axis_textSize = 8\n}\n\nif (!exists(\"mySettingsAxes_x_axis_textRotate\")) {\n mySettingsAxes_x_axis_textRotate = 0\n} else {\n    mySettingsAxes_x_axis_textRotate = as.numeric(mySettingsAxes_x_axis_textRotate)\n}\n\n\n\n\nupdate_geom_defaults(\"text\", list(size = BarSettings_textSize, color = BarSettings_colLabel)) ##sæt nu genereal size her\n\n#############Create Values- dataset from user selected fields####################\n# Set the number of columns\n\ncategory[] <- lapply(category[1], as.character)\n\nValues <- data.frame(category)\nValues2 <- data.frame(category)\n\ninitialize_data_frame <- function(df, str) {\n  if (exists(\"small_multi\")) {\n    small_multi[] <- lapply(small_multi[1], as.character)\n    df <- data.frame(category, small_multi)\n    colnames(df)[length(df)] <- \"small\"\n  }\n\n  for (i in 1:num_cols) {\n    col_name <- paste(str, \"_col\", i, sep = \"\")\n    if (exists(\"category\") && exists(col_name)) {\n      df[[col_name]] <- get(col_name)\n      if(str == \"l\"){\n        test = \"Lower\"\n    } else {\n      test = \"Upper\"\n    }\n      if(exists(paste0(test ,\"ColumnValue\", i, \"Format_Name\"))){\n        if(get(paste0(test ,\"ColumnValue\", i, \"Format_Name\")) == \"\"){\n          colnames(df)[length(df)] <- colnames(get(col_name))\n      } else {\n          colnames(df)[length(df)] <- get(paste0(test ,\"ColumnValue\", i, \"Format_Name\"))\n        }\n      } \n      else{\n      colnames(df)[length(df)] <- colnames(get(col_name))\n      }\n    }\n  }\n  return(df)\n}\n\nValues <- initialize_data_frame(Values, \"l\")\nValues2 <- initialize_data_frame(Values2, \"u\")\n\n\n#######Color Specefications\ndefault_labels <- c(\"#43384a\", \"#59786c\", \"#82231c\", \"#511536\", \"#443e67\", \"#fed34c\", \"#f4d1c1\", \"#71AFE2\", \"#3d3c1d\", \"#625750\")\ncolors = c()\ncolors2 = c()\n\ncolors <- lapply(1:num_cols, function(i) {\n  label_name <- paste(\"LowerColumnValue\", i, \"Format_colLabel\", sep = \"\")\n  label_name2 <- paste(\"LowerColumnValue\", i, \"Format_Name\", sep = \"\")\n  col_name <- paste(\"l_col\", i, sep = \"\")\n\n  if(exists(label_name2) && get(label_name2) != \"\") {\n    if (!exists(label_name) && exists(col_name)) {\n      col_vec = c()\n      name = get(label_name2)\n      col_vec[name] = default_labels[i]\n      value = col_vec[name]\n      return(col_vec)\n    } else if (exists(label_name) && exists(col_name)) {\n      col_vec = c()\n      name = get(label_name2)\n      col_vec[name] = get(label_name)\n      value = col_vec[name]\n      return(value)\n    } \n  } else {\n    if (!exists(label_name) && exists(col_name)) {\n      col_vec = c()\n      name = colnames(get(col_name))\n      col_vec[name] = default_labels[i]\n      value = col_vec[name]\n      return(col_vec)\n    } else if (exists(label_name) && exists(col_name)) {\n      col_vec = c()\n      name = colnames(get(col_name))\n      col_vec[name] = get(label_name)\n      value = col_vec[name]\n      return(value)\n    }\n\n  }\n})\n\ncolors2 <- lapply(1:num_cols, function(i) {\n  label_name <- paste(\"UpperColumnValue\", i, \"Format_colLabel\", sep = \"\")\n  label_name2 <- paste(\"UpperColumnValue\", i, \"Format_Name\", sep = \"\")\n  col_name <- paste(\"u_col\", i, sep = \"\")\n  label <- 5 + i\n  if(exists(label_name2) && get(label_name2) != \"\") {\n    if (!exists(label_name) && exists(col_name)) {\n      col_vec = c()\n      name = get(label_name2)\n      col_vec[name] = default_labels[label]\n      value = col_vec[name]\n      return(col_vec)\n    } else if (exists(label_name) && exists(col_name)) {\n      col_vec = c()\n      name = get(label_name2)\n      col_vec[name] = get(label_name)\n      value = col_vec[name]\n      return(value)\n    } \n  } else {\n    if (!exists(label_name) && exists(col_name)) {\n      col_vec = c()\n      name = colnames(get(col_name))\n      col_vec[name] = default_labels[label]\n      value = col_vec[name]\n      return(col_vec)\n    } else if (exists(label_name) && exists(col_name)) {\n      col_vec = c()\n      name = colnames(get(col_name))\n      col_vec[name] = get(label_name)\n      value = col_vec[name]\n      return(value)\n    }\n\n  }\n})\n\nall_colors <- unlist(c(colors, colors2))\n\n###########Transforming Dataframe###############\ncolnames(Values)[1] = \"x_axis\"\ncolnames(Values2)[1] = \"x_axis\"\n\n\n#Function to make alphabetical order of columns\nassign_numeric_order <- function(data, type_column) {\n  data %>%\n    mutate(numeric_order = match({{type_column}}, rev(sort(unique({{type_column}})))))\n}\n\n# Function to create summary data frame\ncreate_summary_df <- function(data) {\n  if (exists(\"small_multi\") && length(data) > 2) {\n    df = data %>%\n      group_by(x_axis, small) %>%\n      summarise_all(list(c(sum = \"sum\"))) %>%\n      pivot_longer(c(-x_axis, -small), names_to = \"type\", values_to = \"values\") %>%\n      assign_numeric_order(type_column = type) %>%\n      group_by(x_axis, small) %>%\n      arrange(x_axis,small, numeric_order) %>%\n      mutate(sum_values = accumulate(coalesce(values, 0), ~.x + .y)[numeric_order]) %>%\n      ungroup()\n  } else if (!exists(\"small_multi\") && length(data) > 1) {\n    df = data %>%\n      group_by(x_axis) %>%\n      summarise_all(list(c(sum = \"sum\"))) %>%\n      pivot_longer(c(-x_axis), names_to = \"type\", values_to = \"values\") %>%\n      assign_numeric_order(type_column = type) %>%\n      group_by(x_axis) %>%\n      arrange(x_axis, numeric_order) %>%\n      mutate(sum_values = accumulate(coalesce(values, 0), ~.x + .y)[numeric_order]) %>%\n      ungroup()\n  } else {\n    df = data.frame()  # or NULL, depending on your use case\n  }\n  return(df)\n}\n\n# Create summary data frames\ndf = create_summary_df(Values)\ndf2 = create_summary_df(Values2)\n\n#Add type for ploting\ndf = df %>%\n  mutate(type2 = \"type1\")\ndf2 = df2 %>%\n  mutate(type2 = \"type2\")\n\n###############Plotting section################\n\n#Collecting wanted labels\ninitialize_columns <- function(str) {\n  df = data.frame(Variable = c(1),\n                  Name = c(2),\n                  placement = 1)\n  for (i in 1:num_cols) {\n    col_name <- paste(str, \"_col\", i, sep = \"\")\n    if (str == \"l\") text_label = paste(\"LowerColumnValue\", i, \"Format_textLabel\", sep = \"\") else text_label = paste(\"UpperColumnValue\", i, \"Format_textLabel\", sep = \"\")\n    if (str == \"l\") name_label = paste(\"LowerColumnValue\", i, \"Format_Name\", sep = \"\") else name_label = paste(\"UpperColumnValue\", i, \"Format_Name\", sep = \"\")\n    if (exists(col_name) && get(text_label) == TRUE && !exists(name_label)) {\n     new_row = c(Variable = colnames(get(col_name)),\n                 Names = col_name,\n                 placement = get(paste(str_split(text_label, \"_\")[[1]][1], \"_labelPlace\", sep = \"\")))\n      df = rbind(df, new_row)\n    } else if(exists(col_name) && get(text_label) == TRUE && exists(name_label) && get(name_label) != \"\") {\n     new_row = c(Variable = get(name_label),\n                 Names = col_name,\n                 placement = get(paste(str_split(text_label, \"_\")[[1]][1], \"_labelPlace\", sep = \"\")))\n      df = rbind(df, new_row)\n    }else if(exists(col_name) && get(text_label) == TRUE && exists(name_label) && get(name_label) == \"\") {\n     new_row = c(Variable = colnames(get(col_name)),\n                 Names = col_name,\n                 placement = get(paste(str_split(text_label, \"_\")[[1]][1], \"_labelPlace\", sep = \"\")))\n      df = rbind(df, new_row)\n  }\n\n  }\n    df = df[-1,]\n  return(df)\n\n}\nused_labels1 = initialize_columns(\"l\")\nused_labels2 = initialize_columns(\"u\")\nused_labels = rbind(used_labels1, used_labels2)\n\ndf$date_axis = df$x_axis\ndf2$date_axis = df2$x_axis\n\nif(any(grepl(\"^(\\\\d{4}\\\\s?[-\\\\s/]\\\\s?[a-zA-Z]{3,}|[a-zA-Z]{3,}\\\\s?[-\\\\s/]\\\\s?\\\\d{4})$\", df$x_axis, perl = TRUE))) {\n\nconvert_to_date <- function(char_vec) {\nif(any(grepl(\"[-]\", char_vec))) {\n  test = paste0(char_vec, \"-01\")\n} else if (any(grepl(\"[/]\", char_vec))) {\n  test = paste0(char_vec, \"/01\")\n} else {\n  test = paste0(char_vec, \" 01\")\n}\n  \ntryCatch(\n  {\n    return(parse_date_time(test, \n        orders = c(\"%Y %b %d\", \"%b %Y %d\",\n                       \"%Y %B %d\", \"%B %Y %d\",\n                       \"%Y-%b-%d\", \"%b-%Y-%d\",\n                       \"%Y-%B-%d\", \"%B-%Y-%d\",\n                       \"%Y - %B-%d\", \"%B - %Y-%d\",\n                       \"%Y - %b-%d\", \"%b - %Y-%d\",                       \n                       \"%Y/%b/%d\", \"%b/%Y/%d\",\n                       \"%Y/%B/%d\", \"%B/%Y/%d\",\n                       \"%Y / %b/%d\", \"%b / %Y/%d\",\n                       \"%Y / %B/%d\", \"%B / %Y/%d\")))                \n},\nerror = function(err) {\n    # If an error occurs with the English date format, try Danish date format\n    danish_date <- tryCatch(\n      {\n        return(parse_date_time(test, \n        orders = c(\"%Y %b %d\", \"%b %Y %d\",\n                       \"%Y %B %d\", \"%B %Y %d\",\n                       \"%Y-%b-%d\", \"%b-%Y-%d\",\n                       \"%Y-%B-%d\", \"%B-%Y-%d\",\n                       \"%Y/%b/%d\", \"%b-%Y/%d\",\n                       \"%Y/%B/%d\", \"%B-%Y/%d\"), locale = \"da\"))             \n      },\n      error = function(danish_err) {\n        cat(\"Error with Danish date format. Both attempts failed.\\n\")\n        return(NULL)  # Handle the case where both attempts fail\n      }\n    )\n  }\n)\n}\n\nif(length(df) > 1){\ndf$date_axis = convert_to_date(df$x_axis)\n}\nif(length(df2) > 1){\ndf2$date_axis = convert_to_date(df2$x_axis)\n}\n}\n\nmax = max(rbind(df, df2)$sum_values, na.rm = TRUE)\nunit = ifelse(max > 1000000000000, \"bio.\", ifelse(max > 1000000000, \"mia.\", ifelse(max > 1000000, \"mio.\", ifelse(max > 1000, \"tus.\", \"\"))))\nscale = ifelse(max > 1000000000000, 1e-12, ifelse(max > 1000000000, 1e-9, ifelse(max > 1000000, 1e-6, ifelse(max > 1000, 1e-3, \"\"))))\n\ng <- ggplot() +\n  scale_fill_manual(values = all_colors, name = NULL) +\n  scale_y_continuous(labels = unit_format(unit = unit, scale = scale)) +\n  labs(x = mySettingsAxes_x_axis_title, y = mySettingsAxes_y_axis_title) + \n  theme(axis.text.x = element_text(size = mySettingsAxes_x_axis_textSize, angle = mySettingsAxes_x_axis_textRotate),\n        axis.text.y = element_text(size = mySettingsAxes_y_axis_textSize),\n        axis.title.x = element_text(size=mySettingsAxes_x_axis_titleTextSize),\n        axis.title.y = element_text(size=mySettingsAxes_y_axis_titleTextSize))\n#########Hvis plot skal kunne lægges ned og bruges på siden, skal ovenstående ændres, da akserne skal ændres og x og y skal ændres i senere plots\n\n\nif(!exists(\"BarSettings_decimal\")){\n  BarSettings_decimal = 0\n}\nBarSettings_decimal = as.numeric(BarSettings_decimal)\n\nif (exists(\"BarSettings_unitLabel\")) {\n  if(BarSettings_unitLabel == \"auto\") {\n\n  } else{\n  unit = BarSettings_unitLabel\n\n    if(unit == \"tus.\") {\n      scale = 1e-3\n    } else if(unit == \"mio.\") {\n      scale = 1e-6\n    } else if(unit == \"mia.\") {\n      scale = 1e-9\n    } else if(unit == \"bio.\") {\n      scale = 1e-12\n    }\n\n  } \n}\n\n\nif(length(df) > 1){\n  df = df %>%\n    mutate(values2 = ifelse(is.na(values), paste0(\"0\", unit), paste0(as.character(round(values*scale, BarSettings_decimal)), unit))) \n}\n\nif(length(df2) > 1){\n  df2 = df2 %>%\n    mutate(values2 = ifelse(is.na(values), paste0(\"0\", unit), paste0(as.character(round(values*scale, BarSettings_decimal)), unit))) \n}\n\n##########Advanced plotting start################\n\nif(exists(\"small_multi\")) {\n  data_to_use <- if (length(df) == 1) df2 else if (length(df2) == 1) df else merge(df, df2, all = TRUE, by = c(\"values\", \"type\", \"type2\", \"values2\", \"small\", \"numeric_order\", \"sum_values\", \"x_axis\", \"date_axis\"))\n\n  max_value = max(data_to_use$values, na.rm = TRUE)\n  combined = merge(x=data_to_use,y=used_labels, \n             by.x= c(\"type\"), by.y = c(\"Variable\"), all.x=TRUE)\n\ncombined_df = combined %>%\n  mutate(sum_values2 = if_else(placement == \"middle\",\n                               sum_values-values*0.5,\n                               if_else(placement == \"on top\",\n                                       sum_values-max_value*-0.02,\n                                       if_else(placement == \"bottom\",\n                                               (sum_values-values)-max_value*-0.02,\n                                               sum_values-max_value*0.04))))\n\ndata_to_use[is.na(data_to_use)] <- 0\n\ndata_to_use1 = data_to_use %>% select(c(type, values, numeric_order, type2))\n\nformatted_vector1 <- apply(data_to_use1[data_to_use1$type2 == \"type1\",], 1, function(row) {\n  paste0(row[1], \": \", row[2])\n})\n\nformatted_vector2 <- apply(data_to_use1[data_to_use1$type2 == \"type2\",], 1, function(row) {\n  paste0(row[1], \": \", row[2])\n})\n\n  g <- g +\n    geom_col(data = data_to_use[data_to_use$type2 == \"type1\",], \n             aes(x = reorder(x_axis, date_axis), y = values, fill = type, text = formatted_vector1), \n             width = BarSettings_LBarSize) +\n    geom_col(data = data_to_use[data_to_use$type2 == \"type2\",], \n             aes(x = reorder(x_axis, date_axis), y = values, fill = type, text = formatted_vector2), \n             width = BarSettings_UBarSize)+\n             facet_wrap(~small, ncol = SmallMultiSettings_numCol) + ##### Tror alt til small multi format kan lægges her\n             theme(strip.background =element_rect(fill=\"#FFFFFF\"))+\n    geom_text(data = combined_df,\n              aes(x = reorder(x_axis, date_axis),\n                  y = sum_values2),\n              label = combined_df$values2,\n              inherit.aes = FALSE)\n\n} else {\n  data_to_use <- if (length(df) == 1) df2 else if (length(df2) == 1) df else merge(df, df2, all = TRUE, by = c(\"x_axis\", \"values\", \"type\", \"type2\", \"values2\", \"numeric_order\", \"sum_values\", \"x_axis\", \"date_axis\"))\n\n  max_value = max(data_to_use$values, na.rm = TRUE)\n\n  combined = merge(x=data_to_use,y=used_labels, \n             by.x= c(\"type\"), by.y = c(\"Variable\"), all.x=TRUE)\n\ncombined_df = combined %>%\n  mutate(sum_values2 = if_else(placement == \"middle\",\n                               sum_values-values*0.5,\n                               if_else(placement == \"on top\",\n                                       sum_values-max_value*-0.02,\n                                       if_else(placement == \"bottom\",\n                                               (sum_values-values)-max_value*-0.02,\n                                               sum_values-max_value*0.04))))                                              \n\ndata_to_use[is.na(data_to_use)] <- 0\n\ndata_to_use1 = data_to_use %>% select(c(type, values, numeric_order, type2))\n\nformatted_vector1 <- apply(data_to_use1[data_to_use1$type2 == \"type1\",], 1, function(row) {\n  paste0(row[1], \": \", row[2])\n})\n\nformatted_vector2 <- apply(data_to_use1[data_to_use1$type2 == \"type2\",], 1, function(row) {\n  paste0(row[1], \": \", row[2])\n})\n\ng + geom_col(data = data_to_use[data_to_use$type2 == \"type1\",], \n             aes(x = values, y = reorder(x_axis, date_axis)))\n\n  g <- g +\n    geom_col(data = data_to_use[data_to_use$type2 == \"type1\",], \n             aes(x = reorder(x_axis, date_axis), y = values, fill = type, text = formatted_vector1), \n             width = BarSettings_LBarSize) +\n    geom_col(data = data_to_use[data_to_use$type2 == \"type2\",], \n             aes(x = reorder(x_axis, date_axis), y = values, fill = type, text = formatted_vector2), \n             width = BarSettings_UBarSize) +\n    geom_text(data = combined_df,\n              aes(x = reorder(x_axis, date_axis),\n                  y = sum_values2),\n              label = combined_df$values2,\n              inherit.aes = FALSE)\n \n}\n\n####################################################\n\n############# Create and save widget ###############\np = ggplotly(g, tooltip = c(\"text\"))%>%\n  layout(plot_bgcolor= GeneralPlot_colBack,\n        paper_bgcolor = GeneralPlot_colBack,\n         yaxis = list(gridcolor = GeneralPlot_colGrid,\n                      gridwidth = 0.1),\n         xaxis = list(gridcolor = GeneralPlot_colBack,\n                      gridwidth = 0.1),\n         legend = list(orientation = LegendSettings_Orientation,\n                       bgcolor = GeneralPlot_colBack,\n                       y = 1.1,\n                       font = list(size = LegendSettings_textSize),\n                       title=list(text = LegendSettings_legendTitle, font = list(size = LegendSettings_legendTitleSize))),\n         hoverlabel = list(align = \"left\")\n  ) %>% \n  config(displayModeBar = F);\n\n\ninternalSaveWidget(p, 'out.html');\n####################################################\n\n################ Reduce paddings ###################\nReadFullFileReplaceString('out.html', 'out.html', ',\"padding\":[0-9]*,', ',\"padding\":0,')\n####################################################\n"}}}],"objects":{"GeneralPlot":{"displayName":"General plotting settings","description":"General plotting settings","properties":{"colBack":{"displayName":"Background color of plot","description":"The color of the plotly background","type":{"fill":{"solid":{"color":true}}}},"colGrid":{"displayName":"Color of gridlines","description":"The color of the plotly gridlines","type":{"fill":{"solid":{"color":true}}}}}},"mySettingsAxes":{"displayName":"Axes settings","description":"Axes settings","properties":{"x_axis_title":{"displayName":"X axis title","type":{"text":true}},"x_axis_titleTextSize":{"displayName":"X axis title text size","type":{"text":true}},"x_axis_textSize":{"displayName":"X axis labels text size","type":{"text":true}},"x_axis_textRotate":{"displayName":"X axis text rotation degrees","type":{"enumeration":[{"displayName":"0","value":"0"},{"displayName":"10","value":"10"},{"displayName":"20","value":"20"},{"displayName":"45","value":"45"},{"displayName":"90","value":"90"},{"displayName":"270","value":"270"}]}},"y_axis_title":{"displayName":"Y axis title","type":{"text":true}},"y_axis_titleTextSize":{"displayName":"Y axis title text size","type":{"text":true}},"y_axis_textSize":{"displayName":"Y axis text size","type":{"text":true}}}},"BarSettings":{"displayName":"General bar settings","description":"General bar settings and labelling","properties":{"colLabel":{"displayName":"Color of labels","description":"Color of labels","type":{"fill":{"solid":{"color":true}}}},"unitLabel":{"displayName":"Unit","type":{"enumeration":[{"displayName":"auto","value":"auto"},{"displayName":"tus.","value":"tus."},{"displayName":"mio.","value":"mio."},{"displayName":"mia.","value":"mia."},{"displayName":"bio","value":"bio"},{"displayName":"Dont show unit","value":""}]}},"decimal":{"displayName":"Number of decimals","type":{"enumeration":[{"displayName":"0","value":"0"},{"displayName":"1","value":"1"},{"displayName":"2","value":"2"},{"displayName":"3","value":"3"},{"displayName":"4","value":"4"}]}},"textSize":{"displayName":"Font size of labels","type":{"enumeration":[{"displayName":"6","value":"6"},{"displayName":"8","value":"8"},{"displayName":"10","value":"10"},{"displayName":"12","value":"12"},{"displayName":"14","value":"14"},{"displayName":"16","value":"16"},{"displayName":"18","value":"18"},{"displayName":"20","value":"20"}]}},"LBarSize":{"displayName":"Width og lower columns","type":{"enumeration":[{"displayName":"0.2","value":"0.2"},{"displayName":"0.25","value":"0.25"},{"displayName":"0.3","value":"0.3"},{"displayName":"0.35","value":"0.35"},{"displayName":"0.4","value":"0.4"},{"displayName":"0.45","value":"0.45"},{"displayName":"0.5","value":"0.5"},{"displayName":"0.55","value":"0.55"},{"displayName":"0.6","value":"0.6"},{"displayName":"0.65","value":"0.65"},{"displayName":"0.7","value":"0.7"},{"displayName":"0.75","value":"0.75"},{"displayName":"0.8","value":"0.8"},{"displayName":"0.85","value":"0.85"},{"displayName":"0.9","value":"0.9"},{"displayName":"0.95","value":"0.95"},{"displayName":"1","value":"1"}]}},"UBarSize":{"displayName":"Width of upper bar","type":{"enumeration":[{"displayName":"0.05","value":"0.05"},{"displayName":"0.1","value":"0.1"},{"displayName":"0.15","value":"0.15"},{"displayName":"0.2","value":"0.2"},{"displayName":"0.25","value":"0.25"},{"displayName":"0.3","value":"0.3"},{"displayName":"0.35","value":"0.35"},{"displayName":"0.4","value":"0.4"},{"displayName":"0.45","value":"0.45"},{"displayName":"0.5","value":"0.5"},{"displayName":"0.55","value":"0.55"},{"displayName":"0.6","value":"0.6"},{"displayName":"0.65","value":"0.65"},{"displayName":"0.7","value":"0.7"},{"displayName":"0.75","value":"0.75"},{"displayName":"0.8","value":"0.8"},{"displayName":"0.85","value":"0.85"}]}}}},"LegendSettings":{"displayName":"Legend settings","description":"Legend settings","properties":{"Orientation":{"displayName":"Orientation of legend","type":{"enumeration":[{"displayName":"Horizontal","value":"h"},{"displayName":"Vertical","value":"v"}]}},"textSize":{"displayName":"Font size of legend labels","type":{"enumeration":[{"displayName":"1","value":"1"},{"displayName":"2","value":"2"},{"displayName":"4","value":"4"},{"displayName":"6","value":"6"},{"displayName":"8","value":"8"},{"displayName":"10","value":"10"},{"displayName":"12","value":"12"},{"displayName":"14","value":"14"}]}},"legendTitle":{"displayName":"Legend Title","type":{"text":true}},"legendTitleSize":{"displayName":"Legend Title font size","type":{"text":true}}}},"SmallMultiSettings":{"displayName":"Small Multi settings","description":"Small Multi settings","properties":{"numCol":{"displayName":"Number of columns","description":"Number of columns","type":{"text":true}}}},"LowerColumnValue1Format":{"displayName":"Lower column value 1","description":"Lower column value 1 settings","properties":{"Name":{"displayName":"Variable Name","description":"Name of variable","type":{"text":true}},"colLabel":{"displayName":"Color of bar","description":"color of bar","type":{"fill":{"solid":{"color":true}}}},"textLabel":{"displayName":"Label","type":{"bool":true}},"labelPlace":{"displayName":"Label placement","description":"Label placement","type":{"enumeration":[{"displayName":"Top","value":"top"},{"displayName":"On top","value":"on top"},{"displayName":"Middle","value":"middle"},{"displayName":"Bottom","value":"bottom"}]}}}},"LowerColumnValue2Format":{"displayName":"Lower column value 2","description":"Lower column value 2 settings","properties":{"Name":{"displayName":"Variable Name","description":"Name of variable","type":{"text":true}},"colLabel":{"displayName":"Color of bar","description":"color of bar","type":{"fill":{"solid":{"color":true}}}},"textLabel":{"displayName":"Label","type":{"bool":true}},"labelPlace":{"displayName":"Label placement","description":"Label placement","type":{"enumeration":[{"displayName":"Top","value":"top"},{"displayName":"On top","value":"on top"},{"displayName":"Middle","value":"middle"},{"displayName":"Bottom","value":"bottom"}]}}}},"LowerColumnValue3Format":{"displayName":"Lower column value 3","description":"Lower column value 3 settings","properties":{"Name":{"displayName":"Variable Name","description":"Name of variable","type":{"text":true}},"colLabel":{"displayName":"Color of bar","description":"color of bar","type":{"fill":{"solid":{"color":true}}}},"textLabel":{"displayName":"Label","type":{"bool":true}},"labelPlace":{"displayName":"Label placement","description":"Label placement","type":{"enumeration":[{"displayName":"Top","value":"top"},{"displayName":"On top","value":"on top"},{"displayName":"Middle","value":"middle"},{"displayName":"Bottom","value":"bottom"}]}}}},"LowerColumnValue4Format":{"displayName":"Lower column value 4","description":"Lower column value 4 settings","properties":{"Name":{"displayName":"Variable Name","description":"Name of variable","type":{"text":true}},"colLabel":{"displayName":"Color of bar","description":"color of bar","type":{"fill":{"solid":{"color":true}}}},"textLabel":{"displayName":"Label","type":{"bool":true}},"labelPlace":{"displayName":"Label placement","description":"Label placement","type":{"enumeration":[{"displayName":"Top","value":"top"},{"displayName":"On top","value":"on top"},{"displayName":"Middle","value":"middle"},{"displayName":"Bottom","value":"bottom"}]}}}},"LowerColumnValue5Format":{"displayName":"Lower column value 5","description":"Lower column value 5 settings","properties":{"Name":{"displayName":"Variable Name","description":"Name of variable","type":{"text":true}},"colLabel":{"displayName":"Color of bar","description":"color of bar","type":{"fill":{"solid":{"color":true}}}},"textLabel":{"displayName":"Label","type":{"bool":true}},"labelPlace":{"displayName":"Label placement","description":"Label placement","type":{"enumeration":[{"displayName":"Top","value":"top"},{"displayName":"On top","value":"on top"},{"displayName":"Middle","value":"middle"},{"displayName":"Bottom","value":"bottom"}]}}}},"UpperColumnValue1Format":{"displayName":"Upper column value 1","description":"Upper column value 1 settings","properties":{"Name":{"displayName":"Variable Name","description":"Name of variable","type":{"text":true}},"colLabel":{"displayName":"Color of bar","description":"color of bar","type":{"fill":{"solid":{"color":true}}}},"textLabel":{"displayName":"Label","type":{"bool":true}},"labelPlace":{"displayName":"Label placement","description":"Label placement","type":{"enumeration":[{"displayName":"Top","value":"top"},{"displayName":"On top","value":"on top"},{"displayName":"Middle","value":"middle"},{"displayName":"Bottom","value":"bottom"}]}}}},"UpperColumnValue2Format":{"displayName":"Upper column value 2","description":"Upper column value 2 settings","properties":{"Name":{"displayName":"Variable Name","description":"Name of variable","type":{"text":true}},"colLabel":{"displayName":"Color of bar","description":"color of bar","type":{"fill":{"solid":{"color":true}}}},"textLabel":{"displayName":"Label","type":{"bool":true}},"labelPlace":{"displayName":"Label placement","description":"Label placement","type":{"enumeration":[{"displayName":"Top","value":"top"},{"displayName":"On top","value":"on top"},{"displayName":"Middle","value":"middle"},{"displayName":"Bottom","value":"bottom"}]}}}},"UpperColumnValue3Format":{"displayName":"Upper column value 3","description":"Upper column value 3 settings","properties":{"Name":{"displayName":"Variable Name","description":"Name of variable","type":{"text":true}},"colLabel":{"displayName":"Color of bar","description":"color of bar","type":{"fill":{"solid":{"color":true}}}},"textLabel":{"displayName":"Label","type":{"bool":true}},"labelPlace":{"displayName":"Label placement","description":"Label placement","type":{"enumeration":[{"displayName":"Top","value":"top"},{"displayName":"On top","value":"on top"},{"displayName":"Middle","value":"middle"},{"displayName":"Bottom","value":"bottom"}]}}}},"UpperColumnValue4Format":{"displayName":"Upper column value 4","description":"Upper column value 4 settings","properties":{"Name":{"displayName":"Variable Name","description":"Name of variable","type":{"text":true}},"colLabel":{"displayName":"Color of bar","description":"color of bar","type":{"fill":{"solid":{"color":true}}}},"textLabel":{"displayName":"Label","type":{"bool":true}},"labelPlace":{"displayName":"Label placement","description":"Label placement","type":{"enumeration":[{"displayName":"Top","value":"top"},{"displayName":"On top","value":"on top"},{"displayName":"Middle","value":"middle"},{"displayName":"Bottom","value":"bottom"}]}}}},"UpperColumnValue5Format":{"displayName":"Upper column value 5","description":"Upper column value 5 settings","properties":{"Name":{"displayName":"Variable Name","description":"Name of variable","type":{"text":true}},"colLabel":{"displayName":"Color of bar","description":"color of bar","type":{"fill":{"solid":{"color":true}}}},"textLabel":{"displayName":"Label","type":{"bool":true}},"labelPlace":{"displayName":"Label placement","description":"Label placement","type":{"enumeration":[{"displayName":"Top","value":"top"},{"displayName":"On top","value":"on top"},{"displayName":"Middle","value":"middle"},{"displayName":"Bottom","value":"bottom"}]}}}},"rcv_script":{"properties":{"provider":{"type":{"text":true}},"source":{"type":{"scripting":{"source":true}}}}}},"suppressDefaultTitle":false},"dependencies":{"cranPackages":[{"name":"ggplot2","displayName":"GG Plot 2","url":"https://cran.r-project.org/web/packages/ggplot2/index.html"},{"name":"plotly","displayName":"Plotly","url":"https://cran.r-project.org/web/packages/plotly/index.html"},{"name":"htmlwidgets","displayName":"HTML Widgets","url":"https://cran.r-project.org/web/packages/htmlwidgets/index.html"},{"name":"xml2","displayName":"xml2","url":"https://cran.r-project.org/web/packages/xml2/index.html"}]},"content":{"js":"var demoCreation522AEF1866B94124B4C4F588A968843A;(()=>{\"use strict\";var e={934:(e,t,s)=>{s.d(t,{Kq:()=>o,ME:()=>l,Tx:()=>r});var i=s(738);let a=0;function r(){a=0}function o(e,t){let s=[];if(!e||!e.hasChildNodes())return;let i=e.children;for(let e=0;e<i.length;e++){let a;a=\"script\"===i.item(e).nodeName.toLowerCase()?n(i.item(e)):i.item(e).cloneNode(!0),t.appendChild(a),s.push(a)}return s}function n(e){let t=document.createElement(\"script\"),s=e.attributes;for(let e=0;e<s.length;e++)t.setAttribute(s[e].name,s[e].textContent),\"src\"===s[e].name.toLowerCase()&&(a++,t.onload=()=>{a--});return t.innerHTML=e.innerHTML,t}function l(){let e=i.setInterval((()=>{0===a&&(i.clearInterval(e),i.hasOwnProperty(\"HTMLWidgets\")&&i.HTMLWidgets.staticRender&&i.HTMLWidgets.staticRender())}),100)}},50:(e,t,s)=>{s.d(t,{Jx:()=>a});var i=s(554).U;class a extends i{constructor(){super(...arguments),this.GeneralPlot=new o,this.mySettingsAxes=new n,this.BarSettings=new l,this.LegendSettings=new c,this.SmallMultiSettings=new h,this.LowerColumnValue1Format=new u,this.LowerColumnValue2Format=new d,this.LowerColumnValue3Format=new m,this.LowerColumnValue4Format=new p,this.LowerColumnValue5Format=new b,this.UpperColumnValue1Format=new f,this.UpperColumnValue2Format=new g,this.UpperColumnValue3Format=new y,this.UpperColumnValue4Format=new x,this.UpperColumnValue5Format=new w,this.rcv_script=new r}}class r{}class o{constructor(){this.colBack=\"#FFFFFF\",this.colGrid=\"#F1F2F3\"}}class n{constructor(){this.colLabel=\"#FFFFFF\",this.x_axis_title=\"\",this.x_axis_titleTextSize=10,this.x_axis_textSize=8,this.x_axis_textRotate=\"0\",this.y_axis_title=\"\",this.y_axis_titleTextSize=10,this.y_axis_textSize=8}}class l{constructor(){this.colLabel=\"grey\",this.unitLabel=\"auto\",this.decimal=\"0\",this.textSize=\"12\",this.LBarSize=\"0.6\",this.UBarSize=\"0.35\"}}class c{constructor(){this.Orientation=\"h\",this.textSize=\"8\",this.legendTitle=\"\",this.legendTitleSize=\"12\"}}class h{constructor(){this.numCol=2}}class u{constructor(){this.Name=\"\",this.colLabel=\"#43384a\",this.textLabel=!1,this.labelPlace=\"none\"}}class d{constructor(){this.Name=\"\",this.colLabel=\"#59786c\",this.textLabel=!1,this.labelPlace=\"none\"}}class m{constructor(){this.Name=\"\",this.colLabel=\"#82231c\",this.textLabel=!1,this.labelPlace=\"none\"}}class p{constructor(){this.Name=\"\",this.colLabel=\"#511536\",this.textLabel=!1,this.labelPlace=\"none\"}}class b{constructor(){this.Name=\"\",this.colLabel=\"#443e67\",this.textLabel=!1,this.labelPlace=\"none\"}}class f{constructor(){this.Name=\"\",this.colLabel=\"#fed34c\",this.textLabel=!1,this.labelPlace=\"none\"}}class g{constructor(){this.Name=\"\",this.colLabel=\"#f4d1c1\",this.textLabel=!1,this.labelPlace=\"none\"}}class y{constructor(){this.Name=\"\",this.colLabel=\"#71AFE2\",this.textLabel=!1,this.labelPlace=\"none\"}}class x{constructor(){this.Name=\"\",this.colLabel=\"#3d3c1d\",this.textLabel=!1,this.labelPlace=\"none\"}}class w{constructor(){this.Name=\"\",this.colLabel=\"#625750\",this.textLabel=!1,this.labelPlace=\"none\"}}},728:(e,t,s)=>{s.d(t,{u:()=>l});var i,a=s(50),r=s(934),o=s(738);!function(e){e[e.Data=2]=\"Data\",e[e.Resize=4]=\"Resize\",e[e.ViewMode=8]=\"ViewMode\",e[e.Style=16]=\"Style\",e[e.ResizeEnd=32]=\"ResizeEnd\",e[e.All=62]=\"All\"}(i||(i={}));const n=[i.Resize,i.ResizeEnd,i.Resize+i.ResizeEnd];class l{constructor(e){e&&e.element&&(this.rootElement=e.element),this.headNodes=[],this.bodyNodes=[]}update(e){if(!(e&&e.type&&e.viewport&&e.dataViews&&0!==e.dataViews.length&&e.dataViews[0]))return;const t=e.dataViews[0];this.settings=l.parseSettings(t);let s=null;t.scriptResult&&t.scriptResult.payloadBase64&&(s=t.scriptResult.payloadBase64),-1===n.indexOf(e.type)?s&&this.injectCodeFromPayload(s):this.onResizing(e.viewport)}onResizing(e){}injectCodeFromPayload(e){if((0,r.Tx)(),!e)return;let t=document.createElement(\"html\");try{t.innerHTML=o.atob(e)}catch(e){return}if(0===this.headNodes.length){for(;this.headNodes.length>0;){let e=this.headNodes.pop();document.head.removeChild(e)}let e=t.getElementsByTagName(\"head\");if(e&&e.length>0){let t=e[0];this.headNodes=(0,r.Kq)(t,document.head)}}for(;this.bodyNodes.length>0;){let e=this.bodyNodes.pop();this.rootElement.removeChild(e)}let s=t.getElementsByTagName(\"body\");if(s&&s.length>0){let e=s[0];this.bodyNodes=(0,r.Kq)(e,this.rootElement)}(0,r.ME)()}static parseSettings(e){return a.Jx.parse(e)}enumerateObjectInstances(e){return a.Jx.enumerateObjectInstances(this.settings||a.Jx.getDefault(),e)}}},567:(e,t,s)=>{function i(e,t,s){if(!e)return s;let i=e[t];return void 0===i?s:i}s.d(t,{N:()=>i})},982:(e,t,s)=>{s.d(t,{d9:()=>a});var i=s(567);function a(e,t,s){const a=function(e,t,s){return e?i.N(e[t.objectName],t.propertyName,s):s}(e,t,s);return a&&a.solid?a.solid.color:null==a||\"object\"==typeof a&&!a.solid?s:a}},554:(e,t,s)=>{s.d(t,{U:()=>a});var i=s(982);class a{static getDefault(){return new this}static createPropertyIdentifier(e,t){return{objectName:e,propertyName:t}}static parse(e){let t,s=this.getDefault();if(!e||!e.metadata||!e.metadata.objects)return s;t=s.getProperties();for(let a in t)for(let r in t[a]){const o=s[a][r];s[a][r]=i.d9(e.metadata.objects,t[a][r],o)}return s}static isPropertyEnumerable(e){return!a.InnumerablePropertyPrefix.test(e)}static enumerateObjectInstances(e,t){let s=e&&e[t.objectName];if(!s)return[];let i={objectName:t.objectName,selector:null,properties:{}};for(let e in s)s.hasOwnProperty(e)&&(i.properties[e]=s[e]);return{instances:[i]}}getProperties(){let e={};return Object.keys(this).forEach((t=>{if(a.isPropertyEnumerable(t)){let s=Object.keys(this[t]);e[t]={},s.forEach((s=>{a.isPropertyEnumerable(t)&&(e[t][s]=a.createPropertyIdentifier(t,s))}))}})),e}}a.InnumerablePropertyPrefix=/^_/},738:e=>{e.exports=Function(\"return this\")()}},t={};function s(i){var a=t[i];if(void 0!==a)return a.exports;var r=t[i]={exports:{}};return e[i](r,r.exports,s),r.exports}s.d=(e,t)=>{for(var i in t)s.o(t,i)&&!s.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},s.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),s.r=e=>{\"undefined\"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:\"Module\"}),Object.defineProperty(e,\"__esModule\",{value:!0})};var i={};(()=>{s.r(i),s.d(i,{default:()=>r});var e=s(728),t=s(738).powerbi,a={name:\"demoCreation522AEF1866B94124B4C4F588A968843A\",displayName:\"Overlayering Stacked Column chart\",class:\"Visual\",apiVersion:\"3.8.0\",create:t=>{if(e.u)return new e.u(t);throw\"Visual instance not found\"},createModalDialog:(e,t,s)=>{const i=globalThis.dialogRegistry;e in i&&new i[e](t,s)},custom:!0};void 0!==t&&(t.visuals=t.visuals||{},t.visuals.plugins=t.visuals.plugins||{},t.visuals.plugins.demoCreation522AEF1866B94124B4C4F588A968843A=a);const r=a})(),demoCreation522AEF1866B94124B4C4F588A968843A=i})();","css":"","iconBase64":"data:image/jpeg;base64,/9j/4AAQSkZJRgABAQEAYABgAAD/4QDGRXhpZgAATU0AKgAAAAgABFEQAAEAAAABAQAAAFERAAQAAAABAAAOxFESAAQAAAABAAAOxIdpAAQAAAABAAAAPgAAAAAAAZKGAAcAAABuAAAAUAAAAABVTklDT0RFAAB4AHIAOgBkADoARABBAEYANQBrAEwAZwBTAGMAYgBnADoANQAsAGoAOgAzADYAMgA0ADYAOAA2ADkAMwA3ADAAMAAyADMAMwAzADAANQAyACwAdAA6ADIANAAwADEAMQAxADAAOP/bAEMAAgEBAgEBAgICAgICAgIDBQMDAwMDBgQEAwUHBgcHBwYHBwgJCwkICAoIBwcKDQoKCwwMDAwHCQ4PDQwOCwwMDP/bAEMBAgICAwMDBgMDBgwIBwgMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDP/AABEIABQAEwMBIgACEQEDEQH/xAAfAAABBQEBAQEBAQAAAAAAAAAAAQIDBAUGBwgJCgv/xAC1EAACAQMDAgQDBQUEBAAAAX0BAgMABBEFEiExQQYTUWEHInEUMoGRoQgjQrHBFVLR8CQzYnKCCQoWFxgZGiUmJygpKjQ1Njc4OTpDREVGR0hJSlNUVVZXWFlaY2RlZmdoaWpzdHV2d3h5eoOEhYaHiImKkpOUlZaXmJmaoqOkpaanqKmqsrO0tba3uLm6wsPExcbHyMnK0tPU1dbX2Nna4eLj5OXm5+jp6vHy8/T19vf4+fr/xAAfAQADAQEBAQEBAQEBAAAAAAAAAQIDBAUGBwgJCgv/xAC1EQACAQIEBAMEBwUEBAABAncAAQIDEQQFITEGEkFRB2FxEyIygQgUQpGhscEJIzNS8BVictEKFiQ04SXxFxgZGiYnKCkqNTY3ODk6Q0RFRkdISUpTVFVWV1hZWmNkZWZnaGlqc3R1dnd4eXqCg4SFhoeIiYqSk5SVlpeYmZqio6Slpqeoqaqys7S1tre4ubrCw8TFxsfIycrS09TV1tfY2dri4+Tl5ufo6ery8/T19vf4+fr/2gAMAwEAAhEDEQA/AOI8HW3hn4QWvhr4gX/hXxPp+seAZ9L1u+tbbTL5ri4NjcrNdbS8SwlpYdzfvHTY8O3eVbcf17+PPxpX9onWtH+HXij4f+MPBs1n4m8N3epWGtXdg8eqWN9NqKRhXsLycEeZp8u5XKnhCAQePE/jOmq2X7IF54hm8WeONTvPHnw+8fHWbbUfEd5e2M3lafdNFstpZGhh2FRt8tFwOOnFez/tC/8AJ+8f/dPv/Tj4rr6ziriiWdVITlBx5b7y5t7eSslbzPLyzLVg4tJ3vbpbb5s+a/ijqV98KPil4o8O+HNS1bSND0nWb2Czs7e/mEVun2iQ7VG7gZJoqL9pP/k4bxz/ANh69/8AR70V8meoaXgeW/8Ai/4i8efDDWdVvH8L+C/CnjCw0xYo4Y7hEuYpYHLP5fzMEkbbkYBxkHpUek/HPxX8Vfhv8RPivq2rM3i7w1eeFIbF4raFLeNbS61SSPMez5sm+m3ZPICYxg5KKAOt+DvwXsv2hfAUPjXxHqWrSa54kuru8vGtzDFEXN1KPlXy+BgDiiiigD//2Q=="},"visualEntryPoint":"","toolsVersion":null}